!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e="undefined"!=typeof globalThis?globalThis:e||self).wretch=r()}(this,(function(){"use strict";const e="Content-Type",r=Symbol();function t(r={}){var t;return null===(t=Object.entries(r).find((([r])=>r.toLowerCase()===e.toLowerCase())))||void 0===t?void 0:t[1]}function o(e){return/^application\/.*json.*/.test(e)}const n=function(e,r,t=!1){if(!e||!r||"object"!=typeof e||"object"!=typeof r)return e;const o={...e};for(const s in r)r.hasOwnProperty(s)&&(r[s]instanceof Array&&e[s]instanceof Array?o[s]=t?[...e[s],...r[s]]:r[s]:"object"==typeof r[s]&&"object"==typeof e[s]?o[s]=n(e[s],r[s],t):o[s]=r[s]);return o},s={defaults:{},errorType:"text",polyfills:{},polyfill(e,{doThrow:r=!0,instance:t=!1}={},...o){const n=this.polyfills[e]||("undefined"!=typeof self?self[e]:null)||("undefined"!=typeof global?global[e]:null);if(r&&!n)throw new Error(e+" is not defined");return t&&n?new n(...o):n}};class i extends Error{}const l=e=>{const{_url:t,_options:o,_config:s,_catchers:l,_resolvers:c,_middlewares:a,_addons:u}=e,h=new Map(l),f=n(s.defaults,o);u.forEach((r=>r.beforeRequest&&r.beforeRequest(e,f)));const d=(e=>r=>0===e.length?r:1===e.length?e[0](r):e.reduceRight(((t,o,n)=>n===e.length-2?o(t(r)):o(t))))(a)(s.polyfill("fetch"))(t,f),p=new Error,y=d.catch((e=>{throw{__wrap:e}})).then((e=>{if(!e.ok){const r=new i;if(r.cause=p,r.stack=r.stack+"\nCAUSE: "+p.stack,r.response=e,"opaque"===e.type)throw r;return e[s.errorType]().then((t=>{throw r.message=t,r[s.errorType]=t,r.status=e.status,r}))}return e})),_=t=>t.catch((t=>{const o=t.__wrap||t,n=t.__wrap&&h.has(r)?h.get(r):h.get(o.status)||h.get(o.name);if(n)return n(o,e);throw o})),b=e=>r=>_(e?y.then((r=>r&&r[e]())).then((e=>r?r(e):e)):y.then((e=>r?r(e):e))),m={wretchRequest:e,fetchRequest:d,res:b(null),json:b("json"),blob:b("blob"),formData:b("formData"),arrayBuffer:b("arrayBuffer"),text:b("text"),error(e,r){return h.set(e,r),this},badRequest(e){return this.error(400,e)},unauthorized(e){return this.error(401,e)},forbidden(e){return this.error(403,e)},notFound(e){return this.error(404,e)},timeout(e){return this.error(408,e)},internalError(e){return this.error(500,e)},fetchError(e){return this.error(r,e)}},g=u.reduce(((e,r)=>({...e,...r.resolver})),m);return c.reduce(((r,t)=>t(r,e)),g)},c={_url:"",_options:{},_config:s,_catchers:new Map,_resolvers:[],_deferredChain:[],_middlewares:[],_addons:[],clone(e){return{...this,...e}},addon(e){return this.clone({_addons:[...this._addons,e],...e.wretch})},errorType(e){return this.clone({_config:{...this._config,errorType:e}})},polyfills(e,r=!1){return this.clone({_config:{...this._config,polyfills:r?e:n(this._config.polyfills,e)}})},url(e,r=!1){if(r)return this.clone({_url:e});const t=this._url.split("?");return this.clone({_url:t.length>1?t[0]+e+"?"+t[1]:this._url+e})},options(e,r=!1){return this.clone({_options:r?e:n(this._options,e)})},headers(e){return this.clone({_options:n(this._options,{headers:e||{}})})},accept(e){return this.headers({Accept:e})},content(r){return this.headers({[e]:r})},auth(e){return this.headers({Authorization:e})},catcher(e,r){const t=new Map(this._catchers);return t.set(e,r),this.clone({_catchers:t})},resolve(e,r=!1){return this.clone({_resolvers:r?[e]:[...this._resolvers,e]})},defer(e,r=!1){return this.clone({_deferredChain:r?[e]:[...this._deferredChain,e]})},middlewares(e,r=!1){return this.clone({_middlewares:r?e:[...this._middlewares,...e]})},method(e,r="",n=null){let s=this.url(r).options({method:e});const i=t(s._options.headers),c="object"==typeof n&&(!s._options.headers||!i||o(i));return s=n?c?s.json(n,i):s.body(n):s,l(s._deferredChain.reduce(((e,r)=>r(e,e._url,e._options)),s))},get(e=""){return this.method("GET",e)},delete(e=""){return this.method("DELETE",e)},put(e,r=""){return this.method("PUT",r,e)},post(e,r=""){return this.method("POST",r,e)},patch(e,r=""){return this.method("PATCH",r,e)},head(e=""){return this.method("HEAD",e)},opts(e=""){return this.method("OPTIONS",e)},replay(){return this.method(this._options.method)},body(e){return this.clone({_options:{...this._options,body:e}})},json(e,r){const n=t(this._options.headers);return this.content(r||o(n)&&n||"application/json").body(JSON.stringify(e))}},a=()=>{let e=null,r=null;return{beforeRequest(t,o){r=t._config.polyfill("AbortController",{doThrow:!1,instance:!0}),!o.signal&&r&&(o.signal=r.signal),e={ref:null,clear(){e.ref&&(clearTimeout(e.ref),e.ref=null)}}},wretch:{signal(e){return this.clone({_options:{...this._options,signal:e.signal}})}},resolver:{setTimeout(t,o=r){return e.clear(),e.ref=setTimeout((()=>o.abort()),t),this},controller(){return[r,this]},onAbort(e){return this.error("AbortError",e)}}}};function u(e,r=!1,t,o=t.polyfill("FormData",{instance:!0}),n=[]){return Object.entries(e).forEach((([e,s])=>{let i=n.reduce(((e,r)=>e?`${e}[${r}]`:r),null);if(i=i?`${i}[${e}]`:e,s instanceof Array)for(const e of s)o.append(i,e);else!r||"object"!=typeof s||r instanceof Array&&r.includes(e)?o.append(i,s):null!==s&&u(s,r,t,o,[...n,e])})),o}const h={wretch:{formData(e,r=!1){return this.body(u(e,r,this._config))}}};function f(e,r){return encodeURIComponent(e)+"="+encodeURIComponent("object"==typeof r?JSON.stringify(r):""+r)}const d={wretch:{formUrl(e){return this.body("string"==typeof e?e:(r=e,Object.keys(r).map((e=>{const t=r[e];return t instanceof Array?t.map((r=>f(e,r))).join("&"):f(e,t)})).join("&"))).content("application/x-www-form-urlencoded");var r}}},p=(e,r,t,o)=>{if(!e.getEntriesByName)return!1;const n=e.getEntriesByName(r);return!!(n&&n.length>0)&&(t(n.reverse()[0]),o.clearMeasures&&o.clearMeasures(r),y.callbacks.delete(r),y.callbacks.size<1&&(y.observer.disconnect(),o.clearResourceTimings&&o.clearResourceTimings()),!0)},y={callbacks:new Map,observer:null,observe:(e,r,t)=>{if(!e||!r)return;const o=t.polyfill("performance",{doThrow:!1});((e,r)=>(!y.observer&&e&&r&&(y.observer=new r((r=>{y.callbacks.forEach(((t,o)=>{p(r,o,t,e)}))})),e.clearResourceTimings&&e.clearResourceTimings()),y.observer))(o,t.polyfill("PerformanceObserver",{doThrow:!1}))&&(p(o,e,r,o)||(y.callbacks.size<1&&y.observer.observe({entryTypes:["resource","measure"]}),y.callbacks.set(e,r)))}},_=()=>({resolver:{perfs(e){return this.fetchRequest.then((r=>y.observe(r.url,e,this.wretchRequest._config))).catch((()=>{})),this}}}),b=(e,r,t,o)=>{let n;if("string"==typeof r)n=r;else{const e=o.polyfill("URLSearchParams",{instance:!0});for(const t in r)if(r[t]instanceof Array)for(const o of r[t])e.append(t,o);else e.append(t,r[t]);n=e.toString()}const s=e.split("?");return n?t||s.length<2?s[0]+"?"+n:e+"&"+n:t?s[0]:e},m={wretch:{query(e,r=!1){return this.clone({_url:b(this._url,e,r,this._config)})}}};function g(e="",r={}){return c.clone({_url:e,_options:r}).addon(a()).addon(h).addon(d).addon(_()).addon(m)}return g.default=g,g.defaults=function(e,r=!1){s.defaults=r?e:n(s.defaults,e)},g.errorType=function(e){s.errorType=e},g.polyfills=function(e,r=!1){s.polyfills=r?e:n(s.polyfills,e)},g}));
//# sourceMappingURL=wretch.all.min.js.map
