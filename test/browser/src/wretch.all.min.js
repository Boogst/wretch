!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e="undefined"!=typeof globalThis?globalThis:e||self).wretch=r()}(this,(function(){"use strict";const e="Content-Type";function r(r={}){var t;return null===(t=Object.entries(r).find((([r])=>r.toLowerCase()===e.toLowerCase())))||void 0===t?void 0:t[1]}function t(e){return/^application\/.*json.*/.test(e)}const n=function(e,r,t=!1){if(!e||!r||"object"!=typeof e||"object"!=typeof r)return e;const s=Object.assign({},e);for(const o in r)r.hasOwnProperty(o)&&(r[o]instanceof Array&&e[o]instanceof Array?s[o]=t?[...e[o],...r[o]]:r[o]:"object"==typeof r[o]&&"object"==typeof e[o]?s[o]=n(e[o],r[o],t):s[o]=r[o]);return s},s={defaults:{},errorType:null,polyfills:{},polyfill(e,{doThrow:r=!0,instance:t=!1}={},...n){const s=this.polyfills[e]||("undefined"!=typeof self?self[e]:null)||("undefined"!=typeof global?global[e]:null);if(r&&!s)throw new Error(e+" is not defined");return t&&s?new s(...n):s}};class o{constructor(e){this.error=e}}const i=e=>{const{_url:r,_options:t,_config:s,_catchers:i,_resolvers:c,_middlewares:l,_addons:a}=e,h=new Map(i),u=n(s.defaults,t);a.forEach((r=>r.beforeRequest&&r.beforeRequest(e,u)));const f=(e=>r=>0===e.length?r:1===e.length?e[0](r):e.reduceRight(((t,n,s)=>s===e.length-2?n(t(r)):n(t))))(l)(s.polyfill("fetch"))(r,u),d=f.catch((e=>{throw new o(e)})).then((e=>{if(!e.ok){if("opaque"===e.type){const r=new Error("Opaque response");throw r.response=e,r}return e[s.errorType||"text"]().then((r=>{const t=new Error(r);throw t[s.errorType||"text"]=r,t.response=e,t.status=e.status,t}))}return e})),p=r=>r.catch((r=>{const t=r instanceof o?r.error:r;if(r instanceof o&&h.has("__fetchError__"))return h.get("__fetchError__")(t,e);if(h.has(t.status))return h.get(t.status)(t,e);if(h.has(t.name))return h.get(t.name)(t,e);throw t})),_=e=>r=>p(e?d.then((r=>r&&r[e]())).then((e=>r?r(e):e)):d.then((e=>r?r(e):e))),b={wretchRequest:e,fetchRequest:f,res:_(null),json:_("json"),blob:_("blob"),formData:_("formData"),arrayBuffer:_("arrayBuffer"),text:_("text"),error(e,r){return h.set(e,r),this},badRequest(e){return this.error(400,e)},unauthorized(e){return this.error(401,e)},forbidden(e){return this.error(403,e)},notFound(e){return this.error(404,e)},timeout(e){return this.error(408,e)},internalError(e){return this.error(500,e)},fetchError(e){return this.error("__fetchError__",e)}},g=a.reduce(((e,r)=>Object.assign(Object.assign({},e),r.resolver)),b);return c.reduce(((r,t)=>t(r,e)),g)},c={_url:"",_options:{},_config:s,_catchers:new Map,_resolvers:[],_deferredChain:[],_middlewares:[],_addons:[],clone({url:e=this._url,options:r=this._options,config:t=this._config,catchers:n=this._catchers,resolvers:s=this._resolvers,deferredChain:o=this._deferredChain,middlewares:i=this._middlewares,addons:c=this._addons}={}){return Object.assign(Object.assign({},this),{_url:e,_options:Object.assign({},r),_catchers:new Map(n),_config:Object.assign({},t),_resolvers:[...s],_deferredChain:[...o],_middlewares:[...i],_addons:[...c]})},addon(e){return Object.assign(Object.assign({},this.clone({addons:[...this._addons,e]})),e.wretch)},defaults(e,r=!1){return this.clone({config:Object.assign(Object.assign({},this._config),{defaults:r?e:n(this._config.defaults,e)})})},errorType(e){return this.clone({errorType:e})},polyfills(e,r=!1){return this.clone({config:Object.assign(Object.assign({},this._config),{polyfills:r?e:n(this._config.polyfills,e)})})},url(e,r=!1){if(r)return this.clone({url:e});const t=this._url.split("?");return this.clone({url:t.length>1?t[0]+e+"?"+t[1]:this._url+e})},options(e,r=!0){return this.clone({options:r?n(this._options,e):e})},headers(e){return this.clone({options:n(this._options,{headers:e||{}})})},accept(e){return this.headers({Accept:e})},content(r){return this.headers({[e]:r})},auth(e){return this.headers({Authorization:e})},catcher(e,r){const t=new Map(this._catchers);return t.set(e,r),this.clone({catchers:t})},resolve(e,r=!1){return this.clone({resolvers:r?[e]:[...this._resolvers,e]})},defer(e,r=!1){return this.clone({deferredChain:r?[e]:[...this._deferredChain,e]})},middlewares(e,r=!1){return this.clone({middlewares:r?e:[...this._middlewares,...e]})},method(e,n={},s=null){let o=this.options(Object.assign(Object.assign({},n),{method:e}));const c=r(o._options.headers),l="object"==typeof s&&(!o._options.headers||!c||t(c));return o=s?l?o.json(s,c):o.body(s):o,i(o._deferredChain.reduce(((e,r)=>r(e,e._url,e._options)),o))},get(e){return this.method("GET",e)},delete(e){return this.method("DELETE",e)},put(e,r){return this.method("PUT",r,e)},post(e,r){return this.method("POST",r,e)},patch(e,r){return this.method("PATCH",r,e)},head(e){return this.method("HEAD",e)},opts(e){return this.method("OPTIONS",e)},replay(e){return this.method(this._options.method,e)},body(e){return this.clone({options:Object.assign(Object.assign({},this._options),{body:e})})},json(e,n){const s=r(this._options.headers);return this.content(n||t(s)&&s||"application/json").body(JSON.stringify(e))}},l=()=>{let e=null,r=null;return{beforeRequest(t,n){r=t._config.polyfill("AbortController",{doThrow:!1,instance:!0}),!n.signal&&r&&(n.signal=r.signal),e={ref:null,clear(){e.ref&&(clearTimeout(e.ref),e.ref=null)}}},wretch:{signal(e){return this.clone({options:Object.assign(Object.assign({},this._options),{signal:e.signal})})}},resolver:{setTimeout(t,n=r){return e.clear(),e.ref=setTimeout((()=>n.abort()),t),this},controller(){return[r,this]},onAbort(e){return this.error("AbortError",e)}}}};function a(e,r=!1,t,n=t.polyfill("FormData",{instance:!0}),s=[]){return Object.entries(e).forEach((([e,o])=>{let i=s.reduce(((e,r)=>e?`${e}[${r}]`:r),null);if(i=i?`${i}[${e}]`:e,o instanceof Array)for(const e of o)n.append(i+"[]",e);else!r||"object"!=typeof o||r instanceof Array&&r.includes(e)?n.append(i,o):null!==o&&a(o,r,t,n,[...s,e])})),n}const h={wretch:{formData(e,r=!1){return this.body(a(e,r,this._config))}}};function u(e,r){return encodeURIComponent(e)+"="+encodeURIComponent("object"==typeof r?JSON.stringify(r):""+r)}const f={wretch:{formUrl(e){return this.body("string"==typeof e?e:(r=e,Object.keys(r).map((e=>{const t=r[e];return t instanceof Array?t.map((r=>u(e,r))).join("&"):u(e,t)})).join("&"))).content("application/x-www-form-urlencoded");var r}}},d=(e,r,t,n)=>{if(!e.getEntriesByName)return!1;const s=e.getEntriesByName(r);return!!(s&&s.length>0)&&(t(s.reverse()[0]),n.clearMeasures&&n.clearMeasures(r),p.callbacks.delete(r),p.callbacks.size<1&&(p.observer.disconnect(),n.clearResourceTimings&&n.clearResourceTimings()),!0)},p={callbacks:new Map,observer:null,observe:(e,r,t)=>{if(!e||!r)return;const n=t.polyfill("performance",{doThrow:!1});((e,r)=>(!p.observer&&e&&r&&(p.observer=new r((r=>{p.callbacks.forEach(((t,n)=>{d(r,n,t,e)}))})),e.clearResourceTimings&&e.clearResourceTimings()),p.observer))(n,t.polyfill("PerformanceObserver",{doThrow:!1}))&&(d(n,e,r,n)||(p.callbacks.size<1&&p.observer.observe({entryTypes:["resource","measure"]}),p.callbacks.set(e,r)))}},_=()=>({resolver:{perfs(e){return this.fetchRequest.then((r=>p.observe(r.url,e,this.wretchRequest._config))).catch((()=>{})),this}}}),b=(e,r,t,n)=>{let s;if("string"==typeof r)s=r;else{const e=n.polyfill("URLSearchParams",{instance:!0});for(const t in r)if(r[t]instanceof Array)for(const n of r[t])e.append(t,n);else e.append(t,r[t]);s=e.toString()}const o=e.split("?");return s?t||o.length<2?o[0]+"?"+s:e+"&"+s:t?o[0]:e},g={wretch:{query(e,r=!1){return this.clone({url:b(this._url,e,r,this._config)})}}};function y(e="",r={}){return c.clone({url:e,options:r}).addon(l()).addon(h).addon(f).addon(_()).addon(g)}return y.default=y,y.defaults=function(e,r=!1){s.defaults=r?e:n(s.defaults,e)},y.errorType=function(e){s.errorType=e},y.polyfills=function(e,r=!1){s.polyfills=r?e:n(s.polyfills,e)},y}));
//# sourceMappingURL=wretch.all.min.js.map
